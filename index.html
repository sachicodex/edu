<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LearnSphere Tutorials</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons CDN (for Search, BookOpen, MessageSquare, X, Send, Loader2 icons) -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* Custom global styles */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

        :root {
            /* Background and Primary Text Colors */
            --color-gray-950: #0F172A;
            --color-gray-900: #111827;
            --color-gray-800: #1F2937;
            --color-gray-700: #374151;
            --color-gray-600: #4B5563;
            --color-gray-500: #6B7280;
            --color-gray-400: #9CA3AF;
            --color-gray-300: #D1D5DB;
            --color-gray-100: #F3F4F6;

            /* Pink Brand Colors */
            --color-pink-700: #DB2777;
            --color-pink-600: #EC4899;
            --color-pink-500: #EC4899; /* Used for focus rings, matching pink-600 */
            --color-pink-400: #F472B6;
            --color-pink-300: #F472B6; /* Used for hover text, matching pink-400 */

            /* Purple Brand Colors */
            --color-purple-600: #6D28D9;
            --color-purple-500: #A78BFA;
            --color-purple-400: #DDAAEC; /* Used for loader, matching purple-300 */
            --color-purple-300: #DDAAEC;

            /* Red for specific hover */
            --color-red-500: #EF4444;

            /* Green for Start Tutorial link hover */
            --color-green-700: #047857; /* A dark green */

            /* Ripple Color */
            --color-ripple: rgba(172, 126, 255, 0.5); /* Light purple with transparency */

            /* Scrollbar Colors */
            --color-scrollbar-track: #1a202c;
            --color-scrollbar-thumb: #4a5568;
            --color-scrollbar-thumb-hover: #6b7280;

            /* Chatbot Specific Scrollbar Colors */
            --color-chatbot-scrollbar-track: #374151;
            --color-chatbot-scrollbar-thumb: #6b7280;
            --color-chatbot-scrollbar-thumb-hover: #9ca3af;

            /* New: Card Border Color */
            --color-card-border: #4B5563; /* Using gray-600 for the border, as per original border-gray-600 usage */
        }

        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            background-color: #0F172A; /* gray-950 */
            color: #F3F4F6; /* gray-100 */
            overflow-x: hidden;
            padding: 1.5rem; /* p-6 */
            /* Hide default cursor */
            cursor: none;
        }

        /* Custom scrollbar for dark theme */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: var(--color-scrollbar-track);
        }
        ::-webkit-scrollbar-thumb {
            background: var(--color-scrollbar-thumb);
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: var(--color-scrollbar-thumb-hover);
        }

        /* Custom scrollbar for chatbot messages */
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: var(--color-chatbot-scrollbar-track);
            border-radius: 3px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: var(--color-chatbot-scrollbar-thumb);
            border-radius: 3px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: var(--color-chatbot-scrollbar-thumb-hover);
        }

        /* Fade-in-up animation for chatbot */
        @keyframes fadeInMoveUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .animate-fade-in-up {
            animation: fadeInMoveUp 0.3s ease-out forwards;
        }

        /* Modern Scroll Animation Styles */
        @keyframes fadeInSlideUp {
            from {
                opacity: 0;
                transform: translateY(50px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        @keyframes fadeInFromLeft {
            from {
                opacity: 0;
                transform: translateX(-50px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes fadeInFromRight {
            from {
                opacity: 0;
                transform: translateX(50px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes fadeInZoomIn {
            from {
                opacity: 0;
                transform: scale(0.8);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        /* Base class for elements to be animated */
        .animate-on-scroll {
            opacity: 0;
            transform: translateY(30px) scale(0.98);
            transition: opacity 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94),
                        transform 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        /* Class applied when element is in view */
        .animate-on-scroll.is-visible {
            opacity: 1;
            transform: translateY(0) scale(1);
        }

        /* Specific animations for different elements */
        .section-heading.animate-on-scroll {
            animation: fadeInFromLeft 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
            opacity: 0;
            transform: translateX(-50px);
        }
        .section-heading.animate-on-scroll.is-visible {
            animation-play-state: running;
        }

        .section-paragraph.animate-on-scroll {
            animation: fadeInFromRight 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
            opacity: 0;
            transform: translateX(50px);
        }
        .section-paragraph.animate-on-scroll.is-visible {
            animation-play-state: running;
        }

        .search-bar-animate.animate-on-scroll {
            animation: fadeInSlideUp 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
            opacity: 0;
            transform: translateY(50px) scale(0.95);
        }
        .search-bar-animate.animate-on-scroll.is-visible {
            animation-play-state: running;
        }

        /* Staggered animation for tutorial cards */
        .tutorial-card.animate-on-scroll {
            opacity: 0;
            transform: scale(0.8);
            transition: opacity 0.7s cubic-bezier(0.25, 0.46, 0.45, 0.94), transform 0.7s cubic-bezier(0.25, 0.46, 0.45, 0.94),
                        box-shadow 0.3s ease-out, border-color 0.3s ease-out;
        }
        .tutorial-card.animate-on-scroll.is-visible {
            animation: fadeInZoomIn 0.7s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
        }

        /* Hover animation for tutorial cards */
        .tutorial-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 10px 20px rgba(172, 126, 255, 0.3);
            border-color: var(--color-purple-500);
            cursor: none; /* Hide default pointer on hover */
        }

        /* Custom mouse pointer styles */
        #custom-cursor-dot, #custom-cursor-circle {
            position: fixed;
            top: 0;
            left: 0;
            border-radius: 50%;
            pointer-events: none; /* Allows clicks to pass through */
            z-index: 9999; /* Ensure it's on top */
            /* Removed transform: translate(-50%, -50%) from here for the dot to be the true center */
            transition: transform 0.1s ease-out, opacity 0.2s ease-out; /* Add opacity transition */
        }

        #custom-cursor-dot {
            width: 6px;
            height: 6px;
            background-color: var(--color-pink-400); /* Changed to pink */
            opacity: 1; /* Default visible */
            transform: translate(-50%, -50%); /* Center the dot on the exact mouse position */
        }

        #custom-cursor-circle {
            width: 30px;
            height: 30px;
            border: 1px solid var(--color-purple-500); /* Purple border */
            background-color: rgba(167, 139, 250, 0.1); /* Semi-transparent purple fill */
            /* Adjusted transition for smooth color change */
            transition: transform 0.2s ease-out, opacity 0.2s ease-out, width 0.2s ease-out, height 0.2s ease-out, background-color 0.3s ease-out, border-color 0.3s ease-out;
            opacity: 1; /* Default visible */
            transform: translate(-50%, -50%); /* Keep centered */
        }

        /* General interactive element hover effects for custom cursor */
        .interactive-element-hover #custom-cursor-dot {
            opacity: 0; /* Hide dot */
        }

        .interactive-element-hover #custom-cursor-circle {
            width: 45px; /* Slightly larger on hover */
            height: 45px; /* Slightly larger on hover */
            background-color: rgba(236, 72, 153, 0.3); /* More noticeable pink tint on hover */
            border-color: var(--color-pink-600);
        }

        /* Red hover effect for custom cursor on tutorial cards */
        .tutorial-card-hover-red #custom-cursor-dot {
            opacity: 0; /* Hide dot */
        }

        .tutorial-card-hover-red #custom-cursor-circle {
            width: 45px; /* Same size as other interactive elements */
            height: 45px;
            background-color: rgba(239, 68, 68, 0.3); /* Red tint */
            border-color: var(--color-red-500); /* Red border */
        }

        /* Dark green hover effect for custom cursor on 'Start Tutorial' links */
        .start-tutorial-link-hover-green #custom-cursor-dot {
            opacity: 0; /* Hide dot */
        }

        .start-tutorial-link-hover-green #custom-cursor-circle {
            width: 45px; /* Same size as other interactive elements */
            height: 45px;
            background-color: rgba(4, 120, 87, 0.3); /* Dark green tint */
            border-color: var(--color-green-700); /* Dark green border */
        }

        /* Custom Ripple Effect */
        #custom-cursor-ripple {
            position: fixed;
            top: 0;
            left: 0;
            border-radius: 50%;
            pointer-events: none;
            z-index: 9998; /* Below main cursor but above content */
            background-color: var(--color-ripple);
            opacity: 0;
            transform: translate(-50%, -50%) scale(0);
            width: 40px; /* Base size for the ripple */
            height: 40px; /* Base size for the ripple */
        }

        @keyframes ripple-effect {
            0% {
                transform: translate(-50%, -50%) scale(0);
                opacity: 1;
            }
            100% {
                transform: translate(-50%, -50%) scale(4); /* Increased scale for more impact */
                opacity: 0;
            }
        }

        .animate-ripple {
            animation: ripple-effect 0.5s ease-out forwards; /* Adjust duration as needed */
        }


        /* Ensure interactive elements still show pointer cursor */
        button, a, input[type="text"], .tutorial-card {
            cursor: none; /* This will be overridden by the JS for custom cursor, but good for fallback */
        }

    </style>
</head>
<body class="min-h-screen bg-gray-950 text-gray-100 font-inter overflow-x-hidden p-6">

    <!-- Custom Mouse Pointer Elements -->
    <div id="custom-cursor-dot"></div>
    <div id="custom-cursor-circle"></div>
    <div id="custom-cursor-ripple"></div> <!-- New element for click effect -->

    <!-- Tutorials Section -->
    <section class="py-12 px-4 bg-gray-950">
        <h1 class="text-4xl md:text-5xl font-bold text-center text-pink-400 mb-10 animate-on-scroll section-heading">Our Popular Tutorials</h1>
        <p class="text-center text-gray-300 mb-10 max-w-2xl mx-auto text-lg animate-on-scroll section-paragraph">
            Explore our curated collection of tutorials. Use the search bar below to find exactly what you're looking for!
        </p>

        <!-- Search Bar -->
        <div class="max-w-xl mx-auto mb-12 relative animate-on-scroll search-bar-animate">
            <input
                type="text"
                id="searchTermInput"
                autocomplete="off"
                placeholder="Search for tutorials (e.g., React, Figma, JavaScript basics)..."
                class="w-full p-4 pl-12 bg-gray-800 border border-gray-700 rounded-full text-gray-100 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500 transition duration-200"
            />
            <div class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-400">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-search"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
            </div>
            <div id="searchLoader" class="hidden absolute right-4 top-1/2 -translate-y-1/2 text-purple-400 animate-spin">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-loader-2"><path d="M21 12a9 9 0 1 1-6.219-8.56"/></svg>
            </div>
        </div>

        <!-- Tutorial Grid -->
        <div id="tutorialGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-10 max-w-7xl mx-auto">
            <!-- Initial loading message -->
            <div id="initialLoadingMessage" class="col-span-full text-center text-gray-400 text-xl py-20">
                Loading tutorials...
                <div class="mt-4">
                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-loader-2 animate-spin mx-auto text-purple-400"><path d="M21 12a9 9 0 1 1-6.219-8.56"/></svg>
                </div>
            </div>
            <!-- Tutorials will be rendered here by JavaScript -->
        </div>
        <div id="noResultsMessage" class="text-center text-gray-400 text-xl py-20 hidden">
            No tutorials found matching your search. Try a different query!
        </div>
    </section>

    <!-- Floating Chatbot Button -->
    <button
        id="chatbotToggleButton"
        style="cursor: none;"
        class="fixed bottom-6 right-6 bg-pink-600 hover:bg-pink-700 text-white p-4 rounded-full shadow-lg z-50 transform hover:scale-110 transition duration-300 ease-in-out focus:outline-none focus:ring-2 focus:ring-pink-500 focus:ring-offset-2 focus:ring-offset-gray-900"
        aria-label="Toggle Chatbot" 
    >
        <svg id="chatbotOpenIcon" xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-message-square"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
        <svg id="chatbotCloseIcon" xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x hidden"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
    </button>

    <!-- Chatbot Widget -->
    <div id="chatbotContainer" class="fixed bottom-4 right-4 w-80 md:w-96 bg-gray-800 rounded-lg shadow-2xl flex flex-col z-50 border border-gray-700 hidden" >
        <div class="flex justify-between items-center bg-gray-700 p-3 rounded-t-lg border-b border-gray-600">
            <h3 class="text-lg font-semibold text-purple-300">Chat with AI</h3>
            <button id="chatbotCloseButton" class="text-gray-400 hover:text-white transition duration-200" style="cursor: none;">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
            </button>
        </div>
        <div id="messagesContainer" class="flex-1 p-4 overflow-y-auto max-h-80 custom-scrollbar">
            <p id="initialChatbotMessage" class="text-gray-400 text-center text-sm italic">
                Hello! How can I assist you with LearnSphere tutorials today?
            </p>
            <!-- Messages will be appended here -->
        </div>
        <div class="p-3 border-t border-gray-600 flex items-center rounded-b-lg">
            <input
                type="text"
                id="chatInput"
                placeholder="Type your message..."
                class="flex-1 p-2 bg-gray-700 border border-gray-600 rounded-lg text-gray-100 placeholder-gray-400 focus:outline-none focus:ring-1 focus:ring-purple-500"
            />
            <button
                id="sendMessageButton"
                style="cursor: none;"
                class="ml-2 p-2 bg-pink-600 hover:bg-pink-700 text-white rounded-lg transition duration-200 focus:outline-none focus:ring-2 focus:ring-pink-500 focus:ring-offset-2 focus:ring-offset-gray-800"
            >
                <!-- Changed to Lucide Send icon -->
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-send"><path d="m22 2-7 20-4-9-9-4 20-7z"/></svg>
            </button>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-gray-900 py-8 text-center text-gray-500 text-sm rounded-t-xl mt-12 animate-on-scroll">
        <p>&copy; <span id="currentYear"></span> LearnSphere. All rights reserved.</p>
        <p>Empowering Your Learning Journey</p>
    </footer>

    <script>
        let allTutorials = []; // This will now be populated dynamically from JSON files
        let filteredTutorials = [];
        let isSearching = false;
        let searchTimeout;

        // List of tutorial file names (corresponding to tutorial IDs and .json filenames)
        // This array will be AUTOMATICALLY UPDATED by the Node.js script.
        // DO NOT EDIT THIS MANUALLY IF YOU ARE USING THE AUTOMATION SCRIPT.
        const tutorialFileNames = [
            'tds',
            'electronics',
            'automobile',
            'survey',
        ];

        // --- Utility Functions ---
        function debounce(func, delay) {
            let timeout;
            return function(...args) {
                const context = this;
                clearTimeout(timeout);
                timeout = setTimeout(() => func.apply(context, args), delay);
            };
        }

        // --- Tutorial Data Loading ---
        async function loadTutorialsFromFiles() {
            const initialLoadingMessage = document.getElementById('initialLoadingMessage');
            initialLoadingMessage.classList.remove('hidden'); // Show loading message

            const fetchedTutorials = [];
            for (const fileName of tutorialFileNames) {
                try {
                    // Fetching .json files from the 'tutorials' subfolder
                    const response = await fetch(`tutorials/${fileName}.json`);
                    if (!response.ok) {
                        console.error(`Failed to fetch tutorials/${fileName}.json: ${response.status} ${response.statusText}`);
                        continue; // Skip to the next file if one fails
                    }
                    const tutorialData = await response.json(); // Parsing as JSON
                    fetchedTutorials.push(tutorialData);
                } catch (fetchError) {
                    console.error(`Error fetching or parsing tutorials/${fileName}.json:`, fetchError);
                }
            }
            allTutorials = fetchedTutorials;
            filteredTutorials = [...allTutorials]; // Initialize filtered with all loaded tutorials
            initialLoadingMessage.classList.add('hidden'); // Hide loading message
            renderTutorials(filteredTutorials); // Render after loading
        }


        // --- Tutorial Rendering ---
        function renderTutorials(tutorialsToRender) {
            const tutorialGrid = document.getElementById('tutorialGrid');
            const noResultsMessage = document.getElementById('noResultsMessage');
            tutorialGrid.innerHTML = ''; // Clear existing tutorials

            if (tutorialsToRender.length === 0) {
                noResultsMessage.classList.remove('hidden');
                if (isSearching) {
                    noResultsMessage.textContent = 'Searching for tutorials...';
                } else {
                    noResultsMessage.textContent = 'No tutorials found matching your search. Try a different query!';
                }
                return;
            } else {
                noResultsMessage.classList.add('hidden');
            }

            tutorialsToRender.forEach((tutorial, index) => {
                const cardHtml = `
                    <div class="bg-gray-900 rounded-xl shadow-xl overflow-hidden group hover:shadow-purple-500/50 hover:shadow-2xl transform hover:scale-105 transition duration-300 ease-in-out border border-gray-700 hover:border-purple-500 hover:ring-2 hover:ring-purple-500 relative tutorial-card animate-on-scroll"
                        style="border: 1px solid var(--color-card-border);"> <!-- Using CSS variable for border color -->
                        <img
                            src="${tutorial.imageUrl}"
                            alt="${tutorial.title}"
                            class="w-full h-48 object-cover group-hover:opacity-80 transition duration-300"
                            onerror="this.onerror=null;this.src='https://placehold.co/600x400/374151/d1d5db?text=Image+Error';"
                        />
                        <div class="p-6">
                            <h3 class="text-2xl font-semibold text-purple-300 mb-2">${tutorial.title}</h3>
                            <p class="text-gray-400 text-sm mb-4">
                                ${tutorial.description}
                            </p>
                            <div class="flex flex-wrap gap-2 mb-4">
                                ${tutorial.tags.map(tag => `<span class="bg-gray-700 text-gray-300 text-xs px-3 py-1 rounded-full">${tag}</span>`).join('')}
                            </div>
                            <div class="flex justify-end mt-4">
                                <a
                                    href="${tutorial.link}"
                                    target="_blank"
                                    rel="noopener noreferrer"
                                    class="text-pink-400 hover:text-pink-300 font-medium flex items-center space-x-1 start-tutorial-link"
                                >
                                <span style="display: inline-flex; align-items: center;">
                                Start Tutorial
                                <svg style="margin-left: 5px;" xmlns="http://www.w3.org/2000/svg" width="24" height="24" baseProfile="tiny" version="1.2" viewBox="0 0 24 24" id="right-arrow" fill="currentColor">
                                    <path d="M4 19.999a.999.999 0 0 1-1-1v-1a9.98 9.98 0 0 1 8-9.796V6.499c0-.534.208-1.036.585-1.414.756-.757 2.075-.756 2.829-.001l6.288 6.203a.996.996 0 0 1 0 1.424l-6.293 6.207c-.746.746-2.067.751-2.823-.005A1.986 1.986 0 0 1 11 17.499v-1.437c-2.495.201-4.523.985-6.164 3.484a1 1 0 0 1-.836.453zm8-5.989l1-.01v3.499l5.576-5.5L13 6.503V10s-.384-.004-.891.052a7.982 7.982 0 0 0-6.892 6.08C7.338 14.404 9.768 14.066 12 14.01z"></path>
                                </svg>
                                </span>

                                </a>
                            </div>
                        </div>
                    </div>
                `;
                tutorialGrid.insertAdjacentHTML('beforeend', cardHtml);
            });

            // After rendering, observe the new tutorial cards
            // Apply staggered delays dynamically for a smoother effect
            const tutorialCards = tutorialGrid.querySelectorAll('.tutorial-card');
            tutorialCards.forEach((card, i) => {
                card.style.animationDelay = `${i * 0.1}s`; // Staggered delay for each card
            });
            observeElementsForAnimation('.tutorial-card', 'is-visible');
        }

        // --- AI Search Functionality ---
        async function performAISearch(query) {
            isSearching = true;
            document.getElementById('searchLoader').classList.remove('hidden');
            renderTutorials([]); // Show "Searching..." message

            if (query.trim() === '') {
                // If the query is empty, clear filtered tutorials and show no results message
                filteredTutorials = [];
                isSearching = false;
                renderTutorials(filteredTutorials); // This will now show "No tutorials found..."
                document.getElementById('searchLoader').classList.add('hidden');
                return;
            }

            try {
                // Prompt for search functionality
                const prompt = `You are an intelligent tutorial search assistant for LearnSphere. Your primary goal is to find the most relevant tutorial IDs based on a user's query, making the search experience user-friendly and highly engaging.

Here is the list of available tutorials, including their IDs, titles, descriptions, and tags (which represent categories, subjects, and skill levels):
${allTutorials.map(t => `- ID: ${t.id}, Title: ${t.title}, Description: ${t.description}, Tags: ${t.tags.join(', ')}`).join('\n')}

User Query: "${query}"

Instructions for Advanced Search:
1.  **Interpret and Refine Query:**
    * **Spelling Correction:** First, intelligently correct any obvious spelling mistakes or typos in the user's query (e.g., "electnic" should be understood as "electronic").
    * **Summarization/Intent Extraction:** If the query is long, conversational, or vague, distill it down to its core intent, key topics, and relevant keywords. Focus on what the user *really* wants to learn.
2.  **Advanced Analysis:**
    * **Category/Subject Inference:** Infer relevant categories or subjects from the refined query (e.g., 'wire' -> 'electronics', 'design' -> 'UI/UX', 'ML' -> 'Machine Learning', 'tax' -> 'Finance').
    * **Skill Level Detection:** Identify any specified skill levels (e.g., 'advanced', 'beginner', 'basics', 'mastering', 'intro').
    * **Synonym and Related Concepts:** Consider synonyms and closely related concepts to broaden the search intelligently.
3.  **Relevance Matching:** Find the tutorial IDs that are most relevant based on a combination of:
    * Direct keyword matches (from the refined query).
    * Inferred categories/subjects.
    * Detected skill levels.
    * Overall semantic similarity to the tutorial content.
    Prioritize results that offer the best match across these criteria.
4.  **Output Format:** Respond ONLY with a comma-separated list of the 'id's of the relevant tutorials. Do not include any other text, explanations, or formatting. If no tutorials are relevant after your analysis, respond with "none".

Examples of expected output based on various queries:
- Query: "electnic advanced" -> Example Output: electronics,advanced-electronics-tutorial-id (assuming such an advanced electronics tutorial exists and is relevant)
- Query: "basics of figma" -> Example Output: figma-ui-design
- Query: "how to build a website with react" -> Example Output: react-hooks-mastery,nodejs-rest-apis
- Query: "learn about wire" -> Example Output: electronics
- Query: "I want to get into creating digital art for web interfaces, something for people who are just starting out" -> Example Output: graphic-design-basics,figma-ui-design
- Query: "complex grid layouts for responsive pages" -> Example Output: advanced-css-grid`;

                const chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
                const payload = { contents: chatHistory };
                // --- IMPORTANT: Your Gemini API Key for GitHub Pages deployment ---
                const apiKey = "AIzaSyDY5VgoB8_Rvlmna0xPfiRow3FD2VrheQw"; // Re-inserted API Key
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    console.error(`API Error: ${response.status} - ${response.statusText} - ${errorText}`);
                    throw new Error(`API returned an error: ${response.statusText || 'Unknown Error'}`);
                }

                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const aiResponse = result.candidates[0].content.parts[0].text.trim();
                    console.log("AI Search Response:", aiResponse);
                    if (aiResponse.toLowerCase() === 'none' || aiResponse === '') {
                        filteredTutorials = [];
                    } else {
                        const relevantIds = aiResponse.split(',').map(id => id.trim());
                        filteredTutorials = allTutorials.filter(tutorial => relevantIds.includes(tutorial.id));
                    }
                } else {
                    console.warn("AI search response unexpected or empty, falling back to client-side search.");
                    fallbackClientSideSearch(query);
                }
            } catch (error) {
                console.error('Error during AI search:', error);
                appendMessage('bot', "Oops! Something went wrong on my end. Please try again later.");
            } finally {
                isSearching = false;
                renderTutorials(filteredTutorials);
                document.getElementById('searchLoader').classList.add('hidden');
            }
        }

        // Fallback search now only checks title, description, and tags
        function fallbackClientSideSearch(query) {
            const lowerCaseQuery = query.toLowerCase();
            filteredTutorials = allTutorials.filter(tutorial =>
                tutorial.title.toLowerCase().includes(lowerCaseQuery) ||
                tutorial.description.toLowerCase().includes(lowerCaseQuery) ||
                tutorial.tags.some(tag => tag.toLowerCase().includes(lowerCaseQuery))
            );
        }

        // --- Chatbot Functionality (Rebuilt) ---
        const chatMessages = []; // Stores the chat history for context
        let isChatbotLoading = false; // Prevents multiple simultaneous API calls

        /**
         * Appends a message to the chatbot's message container.
         * @param {string} sender - 'user' or 'bot'
         * @param {string} text - The message text
         */
        function appendMessage(sender, text) {
            const messagesContainer = document.getElementById('messagesContainer');
            const initialMessage = document.getElementById('initialChatbotMessage');

            // Remove initial message once the first message (user or bot) is appended
            if (initialMessage) {
                initialMessage.remove();
            }

            const messageDiv = document.createElement('div');
            messageDiv.classList.add('mb-3');
            messageDiv.classList.add(sender === 'user' ? 'text-right' : 'text-left');

            const messageSpan = document.createElement('span');
            messageSpan.classList.add('inline-block', 'p-2', 'rounded-lg', 'max-w-[80%]');
            if (sender === 'user') {
                messageSpan.style.backgroundColor = 'var(--color-purple-600)';
                messageSpan.style.color = 'white';
            } else {
                messageSpan.style.backgroundColor = 'var(--color-gray-700)';
                messageSpan.style.color = 'var(--color-text-gray-100)';
            }
            messageSpan.textContent = text;
            messageDiv.appendChild(messageSpan);
            messagesContainer.appendChild(messageDiv);

            // Scroll to the bottom to show the latest message
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        /**
         * Toggles the visibility of the chatbot loading indicator.
         * @param {boolean} show - True to show, false to hide.
         */
        function showChatbotLoading(show) {
            const messagesContainer = document.getElementById('messagesContainer');
            let loadingDiv = document.getElementById('chatbotLoadingDiv');

            if (show) {
                if (!loadingDiv) {
                    loadingDiv = document.createElement('div');
                    loadingDiv.id = 'chatbotLoadingDiv';
                    loadingDiv.classList.add('text-left', 'mb-3');
                    loadingDiv.innerHTML = `<span class="inline-block p-2 rounded-lg" style="background-color: var(--color-gray-700); color: var(--color-text-gray-100);">Thinking...</span>`;
                    messagesContainer.appendChild(loadingDiv);
                }
                messagesContainer.scrollTop = messagesContainer.scrollHeight; // Scroll to show thinking message
            } else {
                if (loadingDiv) {
                    loadingDiv.remove(); // Remove the loading indicator
                }
            }
        }

        /**
         * Sends a message to the Gemini API and handles the response for the chatbot.
         */
        async function sendChatMessage() {
            const chatInput = document.getElementById('chatInput');
            const message = chatInput.value.trim();

            if (message === '') return; // Don't send empty messages
            if (isChatbotLoading) return; // Prevent multiple sends

            // Append user message to UI and clear input
            appendMessage('user', message);
            chatMessages.push({ sender: 'user', text: message }); // Add to history
            chatInput.value = '';

            // Disable input and button, show loading indicator
            isChatbotLoading = true;
            chatInput.disabled = true;
            document.getElementById('sendMessageButton').disabled = true;
            showChatbotLoading(true);

            try {
                let botResponseText;

                // Check for specific "who are you" query
                if (message.toLowerCase() === 'who are you') {
                    botResponseText = 'Name : Sachintha Lakshan';
                } else {
                    // Prepare chat history for the API call
                    // Include a system instruction to guide the AI's persona and knowledge base
                    let chatHistory = [{
                        role: "user",
                        parts: [{ text: "You are a helpful assistant for LearnSphere, an online tutorial platform. Answer questions about web development, UI/UX design, programming (like JavaScript, React, Node.js, Java), CSS, HTML, and general learning. Keep your answers concise and directly related to learning or our tutorials. Do not engage in topics outside of LearnSphere's educational content. If asked about something unrelated, politely redirect to our tutorials. " }]
                    }];

                    // Add previous messages to history for context, limiting to a few for efficiency
                    // Ensure roles are 'user' or 'model' for the API
                    const recentMessages = chatMessages.slice(Math.max(chatMessages.length - 6, 0)); // Keep last 6 messages for context
                    recentMessages.forEach(msg => {
                        chatHistory.push({ role: msg.sender === 'user' ? 'user' : 'model', parts: [{ text: msg.text }] });
                    });

                    // Add the current user message
                    chatHistory.push({ role: "user", parts: [{ text: message }] });

                    const payload = { contents: chatHistory };
                    // --- IMPORTANT: Your Gemini API Key for GitHub Pages deployment ---
                    const apiKey = "AIzaSyDY5VgoB8_Rvlmna0xPfiRow3FD2VrheQw"; // Re-inserted API Key
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        const errorText = await response.text();
                        console.error(`API Error: ${response.status} - ${response.statusText} - ${errorText}`);
                        throw new Error(`API returned an error: ${response.statusText || 'Unknown Error'}`);
                    }

                    const result = await response.json();

                    if (result.candidates && result.candidates.length > 0 &&
                        result.candidates[0].content && result.candidates[0].content.parts &&
                        result.candidates[0].content.parts.length > 0) {
                        botResponseText = result.candidates[0].content.parts[0].text;
                    } else {
                        console.warn("Chatbot AI response structure unexpected or empty.");
                        botResponseText = "Sorry, I couldn't get a clear response. Can you please rephrase?";
                    }
                }

                // Append bot's response to UI and history
                appendMessage('bot', botResponseText);
                chatMessages.push({ sender: 'bot', text: botResponseText }); // Add to history

            } catch (error) {
                console.error('Error during chatbot API call:', error);
                appendMessage('bot', "Oops! Something went wrong on my end. Please try again later.");
            } finally {
                // Re-enable input and button, hide loading indicator
                isChatbotLoading = false;
                chatInput.disabled = false;
                document.getElementById('sendMessageButton').disabled = false;
                showChatbotLoading(false);
            }
        }

        /**
         * Toggles the visibility of the chatbot widget.
         */
        function toggleChatbot() {
            const chatbotContainer = document.getElementById('chatbotContainer');
            const openIcon = document.getElementById('chatbotOpenIcon');
            const closeIcon = document.getElementById('chatbotCloseIcon');

            if (chatbotContainer.classList.contains('hidden')) {
                chatbotContainer.classList.remove('hidden');
                chatbotContainer.classList.add('animate-fade-in-up');
                openIcon.classList.add('hidden');
                closeIcon.classList.remove('hidden');
            } else {
                chatbotContainer.classList.add('hidden');
                chatbotContainer.classList.remove('animate-fade-in-up');
                openIcon.classList.remove('hidden');
                closeIcon.classList.add('hidden');
            }
        }

        // --- Intersection Observer for Scroll Animations ---
        function observeElementsForAnimation(selector, animationClass) {
            const elements = document.querySelectorAll(selector);

            const observer = new IntersectionObserver((entries, observer) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        // Add the animation class
                        entry.target.classList.add(animationClass);
                    } else {
                        // Remove the animation class when the element is out of view
                        entry.target.classList.remove(animationClass);
                        // Reset animation for elements that use keyframe animations
                        if (entry.target.classList.contains('section-heading') ||
                            entry.target.classList.contains('section-paragraph') ||
                            entry.target.classList.contains('search-bar-animate') ||
                            entry.target.classList.contains('tutorial-card') ||
                            entry.target.tagName.toLowerCase() === 'footer') {
                            // To re-trigger keyframe animations, remove and re-add the class
                            // A small timeout ensures the browser registers the removal before re-adding
                            setTimeout(() => {
                                entry.target.style.animation = 'none'; // Temporarily disable animation
                                entry.target.offsetHeight; // Trigger reflow
                                entry.target.style.animation = ''; // Re-enable animation
                            }, 10);
                        }
                    }
                });
            }, {
                root: null, // viewport
                threshold: 0.1 // Trigger when 10% of the element is visible
            });

            elements.forEach(element => {
                observer.observe(element);
            });
        }

        // Smooth scroll for scroll wheel
        let currentScrollY = window.scrollY;
        let animationFrameId = null;

        function smoothScrollTo(targetScrollY, duration = 500) {
            const start = window.scrollY;
            const change = targetScrollY - start;
            const startTime = performance.now();

            function animateScroll(currentTime) {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);

                const easedProgress = progress * (2 - progress);

                window.scrollTo(0, start + change * easedProgress);

                if (progress < 1) {
                    animationFrameId = requestAnimationFrame(animateScroll);
                } else {
                    animationFrameId = null;
                }
            }

            if (animationFrameId) {
                cancelAnimationFrame(animationFrameId);
            }
            animationFrameId = requestAnimationFrame(animateScroll);
        }

        // Event listener for scroll wheel
        window.addEventListener('wheel', (e) => {
            e.preventDefault();

            const scrollAmount = e.deltaY * 0.8;
            currentScrollY += scrollAmount;

            const maxScrollY = document.documentElement.scrollHeight - window.innerHeight;
            currentScrollY = Math.max(0, Math.min(currentScrollY, maxScrollY));

            smoothScrollTo(currentScrollY, 500);
        }, { passive: false });

        // --- Custom Cursor JavaScript ---
        const customCursorDot = document.getElementById('custom-cursor-dot');
        const customCursorCircle = document.getElementById('custom-cursor-circle');
        const customCursorRipple = document.getElementById('custom-cursor-ripple'); // Get ripple element

        let mouseX = 0;
        let mouseY = 0;
        let circleX = 0;
        let circleY = 0;

        document.addEventListener('mousemove', (e) => {
            mouseX = e.clientX;
            mouseY = e.clientY;
            // The dot is now positioned directly at mouseX, mouseY and centered via CSS transform
            customCursorDot.style.left = `${mouseX}px`;
            customCursorDot.style.top = `${mouseY}px`;

            // Determine if the hovered element is interactive or a 'start tutorial' link
            const target = e.target;
            const isStartTutorialLink = target.closest('.start-tutorial-link');
            const isTutorialCard = target.closest('.tutorial-card');
            const isInputOrButton = target.tagName === 'BUTTON' || target.tagName === 'INPUT';

            // Reset all custom cursor classes first
            document.body.classList.remove('hide-custom-cursor');
            document.body.classList.remove('interactive-element-hover');
            document.body.classList.remove('tutorial-card-hover-red');
            document.body.classList.remove('start-tutorial-link-hover-green');


            if (isStartTutorialLink) {
                document.body.classList.add('start-tutorial-link-hover-green');
            } else if (isTutorialCard) {
                document.body.classList.add('tutorial-card-hover-red');
            } else if (isInputOrButton) {
                document.body.classList.add('interactive-element-hover');
            }
        });

        // Handle mousedown for ripple effect
        document.addEventListener('mousedown', (e) => {
            // Only trigger ripple if the custom cursor is visible (not on 'start tutorial' link)
            // The `start-tutorial-link-hover-green` class is applied when hovering over the link,
            // which also means the custom cursor is hidden. So, if this class is present, don't show ripple.
            if (!document.body.classList.contains('start-tutorial-link-hover-green')) {
                customCursorRipple.style.left = `${e.clientX}px`;
                customCursorRipple.style.top = `${e.clientY}px`;

                // Reset animation by removing and re-adding class, forcing reflow
                customCursorRipple.classList.remove('animate-ripple');
                // A small timeout ensures the browser registers the removal before re-adding
                setTimeout(() => {
                    customCursorRipple.classList.add('animate-ripple');
                }, 10); // Small delay to ensure animation reset
            }
        });


        function animateCustomCursor() {
            // Lerp (linear interpolation) for smooth trailing effect
            // The circle now interpolates towards the dot's position (which is the true mouseX, mouseY)
            circleX += (mouseX - circleX) * 0.2; /* Adjusted lerp for tighter follow */
            circleY += (mouseY - circleY) * 0.2; /* Adjusted lerp for tighter follow */

            customCursorCircle.style.left = `${circleX}px`;
            customCursorCircle.style.top = `${circleY}px`;

            requestAnimationFrame(animateCustomCursor);
        }

        // Start the custom cursor animation loop
        animateCustomCursor();

        // --- Event Listeners and Initial Setup ---
        document.addEventListener('DOMContentLoaded', () => {
            // Set current year in footer
            document.getElementById('currentYear').textContent = new Date().getFullYear();

            // Load tutorials from files
            loadTutorialsFromFiles(); // This function will now fetch from JSON files

            // Observe all relevant elements for animation
            observeElementsForAnimation('.section-heading', 'is-visible');
            observeElementsForAnimation('.section-paragraph', 'is-visible');
            observeElementsForAnimation('.search-bar-animate', 'is-visible');
            observeElementsForAnimation('footer', 'is-visible');
            // Tutorial cards are observed within renderTutorials to ensure they are present in DOM


            // Search input event listener with debounce
            const searchTermInput = document.getElementById('searchTermInput');
            searchTermInput.addEventListener('input', debounce((e) => {
                performAISearch(e.target.value);
            }, 200));

            // Chatbot button listeners
            document.getElementById('chatbotToggleButton').addEventListener('click', toggleChatbot);
            document.getElementById('chatbotCloseButton').addEventListener('click', toggleChatbot);
            document.getElementById('sendMessageButton').addEventListener('click', sendChatMessage);
            document.getElementById('chatInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    sendChatMessage();
                }
            });
        });
    </script>
</body>
</html>
