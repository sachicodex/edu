<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LearnSphere Tutorials - Modern Dark Theme</title>
    <!-- Lucide Icons CDN (for Search, BookOpen, MessageSquare, X, Send, Loader2 icons) -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* Custom global styles - System UI Style with Brand Colors (Inspired by Coxora Website) */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Orbitron:wght@400;500;600;700&display=swap');

        :root {
            /* Background and Primary Text Colors (Inspired by Coxora Website) */
            --color-background-primary: #000002; /* Very Deep Purple-Black */
            --color-card-background: linear-gradient(135deg, #151820, #151820); /* Darker purple gradient for cards/footer */
            --color-input-background: #151820; /* Dark purple for inputs */
            --color-chatbot-header-background: #151820; /* Medium purple for chatbot header */
            --color-tag-background: transparent; /* Tags will be outlined */
            --color-border-primary: #353843; /* Border for main elements (cards, search, chatbot) */
            --color-border-secondary: #353843; /* Slightly lighter border for internal dividers */
            --color-footer-text: #B0B0E0; /* Soft light blue/purple for footer text */
            --color-placeholder-text: #62646d; /* Muted purple placeholder text */
            --color-secondary-text: #D0D0FF; /* Medium light blue/purple for descriptions, icons */
            --color-paragraph-text: #E8E8FF; /* Light blue/purple for main paragraphs */
            --color-primary-text: #F8F8FF; /* Near white for headings and main content */

            /* Brand Colors (Inspired by Coxora - Primary Accent: Vibrant Blue/Cyan) */
            --color-brand-accent-blue-pure: #00CCFF; /* Vibrant Sky Blue for strong highlights */
            --color-brand-accent-blue-interactive: #00AADD; /* Slightly desaturated for interactive elements (links, card titles) */
            --color-brand-accent-blue-dark: #0077AA; /* Darker shade for gradients/shadows */
            --color-brand-accent-blue-light: #66EEFF; /* Lighter shade for glows */

            /* Brand Colors (Inspired by Coxora - Secondary Accent: Vibrant Pink/Magenta) */
            --color-brand-accent-pink-pure: #FF00FF; /* Vibrant Pink/Magenta for general UI buttons, main heading glow */
            --color-brand-accent-pink-interactive: #DD00DD; /* Desaturated Pink/Magenta for general UI interactive elements */
            --color-brand-accent-pink-dark: #AA00AA; /* Darker pink for button hover */

            /* Derived Colors for UI Elements (General UI, Chatbot, Search) */
            --color-button-primary-bg: rgb(255, 174, 0); /* Chatbot button, general UI buttons */
            --color-button-primary-hover-bg: var(--color-brand-accent-pink-dark); /* Darker pink on hover */
            --color-focus-ring-accent: #4b4e58; /* Search input focus, general focus */
            --color-heading-primary: var(--color-primary-text); /* Main headings */
            --color-link-primary: var(--color-brand-accent-pink-interactive); /* General links */
            --color-link-hover: var(--color-brand-accent-pink-pure); /* Pure pink on general link hover */

            /* Cursor Colors - Primary accent (Blue/Cyan) for card hover, Secondary (Pink/Magenta) for general interactive */
            --color-cursor-dot: var(--color-brand-accent-blue-pure); /* Dot uses blue/cyan */
            --color-cursor-interactive-border-hover: var(--color-brand-accent-pink-interactive); /* General interactive uses pink */
            --color-cursor-card-hover-border: var(--color-brand-accent-blue-pure); /* Blue glow for card hover */
            --color-cursor-link-hover-border: var(--color-brand-accent-blue-interactive); /* Blue glow for card link hover */

            /* Chatbot Specific Colors */
            --color-chatbot-user-message-bg: #212630; /* Darker purple for user messages */
            --color-chatbot-bot-message-bg: #25282e; /* Slightly lighter purple for bot messages */
            --color-chatbot-header-text: var(--color-primary-text); /* Chatbot header text is primary */

            /* Tutorial Card Specific Colors - Using Blue/Cyan accents */
            --color-tutorial-title: var(--color-brand-accent-blue-interactive); /* Card titles use interactive blue/cyan */
            --color-card-hover-shadow: rgba(0, 204, 255, 0.4); /* Interactive blue/cyan glow for card hover */
            --color-card-hover-border: #4b4e58; /* Pure blue/cyan border on card hover */
            --color-link-primary-card: var(--color-brand-accent-blue-interactive); /* Card specific link color */
            --color-link-hover-card: var(--color-brand-accent-blue-pure); /* Card specific link hover color */
            --color-tag-border: var(--color-brand-accent-blue-interactive); /* Blue/cyan border for tags */
            --color-tag-hover-bg: rgba(0, 204, 255, 0.1); /* Subtle transparent blue/cyan for tag hover */

            --color-loader-icon: var(--color-brand-accent-pink-interactive); /* Loader icon uses pink accent */

            --color-ripple-effect: rgba(255, 0, 255, 0.4); /* Ripple effect uses pink accent */

            /* Scrollbar Colors */
            --color-scrollbar-track: #1A0033; /* Matches primary background */
            --color-scrollbar-thumb: #5500AA; /* Matches primary border */
            --color-scrollbar-thumb-hover: #7700DD; /* Lighter on hover */

            /* Chatbot Specific Scrollbar Colors */
            --color-chatbot-scrollbar-track: #330066; /* Matches input background */
            --color-chatbot-scrollbar-thumb: #7700DD;
            --color-chatbot-scrollbar-thumb-hover: #9900FF;

            /* Error and Success Colors (Adjusted for new palette) */
            --color-error-text: #FF9999; /* Softer Red */
            --color-error-background: #660033; /* Dark Reddish Purple */
            --color-success-text: #99FF99; /* Softer Green */
            --color-success-background: #336600; /* Dark Greenish Purple */
        }

        body {
            font-family: 'Inter', sans-serif; /* Primary body font for readability */
            margin: 0;
            background-color: var(--color-background-primary);
            color: var(--color-primary-text);
            overflow-x: hidden;
            padding: 2.5rem; /* Increased padding for spacious feel */
            cursor: none; /* Hide default cursor */
            line-height: 1.6;
            -webkit-font-smoothing: antialiased; /* Smoother fonts */
            -moz-osx-font-smoothing: grayscale;
        }

        /* Mobile adjustments */
        @media (max-width: 767px) {
            body {
                padding: 1rem; /* Reduced padding on mobile */
            }
        }

        /* Utility class for hiding elements */
        .hidden {
            display: none !important;
        }

        /* Custom scrollbar for dark theme */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: var(--color-scrollbar-track);
        }
        ::-webkit-scrollbar-thumb {
            background: var(--color-scrollbar-thumb);
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: var(--color-scrollbar-thumb-hover);
        }

        /* Custom scrollbar for chatbot messages */
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: var(--color-chatbot-scrollbar-track);
            border-radius: 3px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: var(--color-chatbot-scrollbar-thumb);
            border-radius: 3px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: var(--color-chatbot-scrollbar-thumb-hover);
        }

        /* Fade-in-up animation for chatbot */
        @keyframes fadeInMoveUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .animate-fade-in-up {
            animation: fadeInMoveUp 0.4s ease-out forwards;
        }

        /* Modern Scroll Animation Styles */
        @keyframes fadeInSlideUp {
            from {
                opacity: 0;
                transform: translateY(60px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        @keyframes fadeInFromLeft {
            from {
                opacity: 0;
                transform: translateX(-70px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes fadeInFromRight {
            from {
                opacity: 0;
                transform: translateX(70px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes fadeInZoomIn {
            from {
                opacity: 0;
                transform: scale(0.7);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        /* Base class for elements to be animated */
        .animate-on-scroll {
            opacity: 0;
            transform: translateY(40px) scale(0.95);
            transition: opacity 0.9s cubic-bezier(0.25, 0.46, 0.45, 0.94),
                        transform 0.9s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        /* Class applied when element is in view */
        .animate-on-scroll.is-visible {
            opacity: 1;
            transform: translateY(0) scale(1);
        }

        /* Specific animations for different elements */
        .section-heading.animate-on-scroll {
            animation: fadeInFromLeft 0.9s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
            opacity: 0;
            transform: translateX(-70px);
        }
        .section-heading.animate-on-scroll.is-visible {
            animation-play-state: running;
        }

        .section-paragraph.animate-on-scroll {
            animation: fadeInFromRight 0.9s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
            opacity: 0;
            transform: translateX(70px);
        }
        .section-paragraph.animate-on-scroll.is-visible {
            animation-play-state: running;
        }

        .search-bar-container.animate-on-scroll {
            animation: fadeInSlideUp 0.9s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
            opacity: 0;
            transform: translateY(60px) scale(0.9);
        }
        .search-bar-container.animate-on-scroll.is-visible {
            animation-play-state: running;
        }

        /* Tutorial Card Base Styles */
        .tutorial-card {
            border-radius: 0.75rem; /* Rounded corners */
            /* Updated box-shadow to include a subtle blue/cyan glow */
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4), 0 0 10px var(--color-card-hover-shadow);
            overflow: hidden;
            border: 0.16em solid var(--color-border-primary);
            background-image: var(--color-card-background);
            position: relative;
            transition: transform 0.3s ease-out, box-shadow 0.3s ease-out, border-color 0.3s ease-out;
            display: flex;
            flex-direction: column;
        }

        /* Staggered animation for tutorial cards (keep existing) */
        .tutorial-card.animate-on-scroll {
            opacity: 0;
            transform: scale(0.7);
            transition: opacity 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94), transform 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94),
                        box-shadow 0.3s ease-out, border-color 0.3s ease-out;
        }
        .tutorial-card.animate-on-scroll.is-visible {
            animation: fadeInZoomIn 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
        }

        /* Hover animation for tutorial cards (pure CSS) */
        .tutorial-card:hover {
            transform: translateY(-6px) scale(1.02); /* Subtle lift */
            /* Stronger blue/cyan glow on hover */
            box-shadow: 0 12px 35px var(--color-card-hover-shadow), 0 0 0 3px var(--color-card-hover-border);
            border-color: transparent; /* Pure blue/cyan border on hover */
            cursor: none;
        }

        /* Tutorial Card Image */
        .tutorial-card-image {
            width: 100%;
            height: 12rem; /* Consistent image height */
            object-fit: cover;
            transition: opacity 0.3s;
            border-bottom: 1px solid var(--color-border-secondary); /* Separator */
        }
        /* Mobile adjustment for image height */
        @media (max-width: 767px) {
            .tutorial-card-image {
                height: 10rem; /* Slightly shorter on mobile */
            }
        }

        /* Tutorial Card Content Area */
        .tutorial-card-content {
            padding: 1.5rem;
            flex-grow: 1; /* Allows content to expand */
            display: flex;
            flex-direction: column;
        }
        /* Mobile adjustment for content padding */
        @media (max-width: 767px) {
            .tutorial-card-content {
                padding: 1rem;
            }
        }

        /* Tutorial Title - Now uses Blue/Cyan accent */
        .tutorial-title {
            font-family: 'Inter'; /* Heading font */
            font-size: 1.7rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--color-tutorial-title); /* Uses new blue/cyan accent */
        }
        /* Mobile adjustment for title font size */
        @media (max-width: 767px) {
            .tutorial-title {
                font-size: 1.2rem;
            }
        }

        /* Tutorial Description */
        .tutorial-description {
            font-size: 0.9rem;
            margin-bottom: 1rem;
            color: var(--color-secondary-text);
            flex-grow: 1; /* Allows description to take available space */
        }
        /* Mobile adjustment for description font size */
        @media (max-width: 767px) {
            .tutorial-description {
                font-size: 0.8rem;
            }
        }

        /* Tutorial Tags Container */
        .tutorial-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 0.75rem; /* Space above tags */
            margin-bottom: 1.25rem;
        }
        /* Mobile adjustment for tag gap */
        @media (max-width: 767px) {
            .tutorial-tags {
                gap: 0.4rem;
                margin-bottom: 1rem;
            }
        }

        /* Individual Tag - Now uses Blue/Cyan border and subtle hover */
        .tutorial-tag {
            font-size: 0.75rem;
            padding: 0.25rem 0.75rem;
            border-radius: 0.5rem; /* Slightly less rounded */
            background-color: transparent; /* Transparent background */
            color: var(--color-secondary-text); /* Tags text is secondary text color */
            border: 1px solid var(--color-tag-border); /* Blue/cyan border for tags */
            transition: background-color 0.2s, border-color 0.2s, color 0.2s;
        }
        .tutorial-tag:hover {
            background-color: var(--color-tag-hover-bg); /* Subtle transparent blue/cyan fill on hover */
            border-color: var(--color-brand-accent-blue-pure); /* Pure blue/cyan border on hover */
        }
        /* Mobile adjustment for tag font size and padding */
        @media (max-width: 767px) {
            .tutorial-tag {
                font-size: 0.7rem;
                padding: 0.2rem 0.6rem;
            }
        }

        /* Start Tutorial Link Container */
        .start-tutorial-link-container {
            display: flex;
            justify-content: flex-end;
            margin-top: 1rem;
        }
        /* Mobile adjustment for link container margin */
        @media (max-width: 767px) {
            .start-tutorial-link-container {
                margin-top: 0.75rem;
            }
        }

        /* Start Tutorial Link - Now uses Blue/Cyan accent */
        .start-tutorial-link {
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.4rem;
            color: var(--color-link-primary-card); /* Uses new blue/cyan accent for links */
            transition: color 0.3s, text-shadow 0.3s, border-color 0.3s;
            text-decoration: none;
            padding: 0.5rem 0.75rem; /* Added padding for better click area */
            border-radius: 0.5rem;
            border: 1px solid transparent; /* Placeholder border for transition */
        }
        .start-tutorial-link:hover {
            color: var(--color-link-hover-card); /* Pure blue/cyan on link hover for pop */
            text-shadow: 0 0 6px var(--color-link-hover-card);
            border-color: var(--color-brand-accent-blue-pure); /* Border glow on hover */
        }
        /* Mobile adjustment for link padding and font size */
        @media (max-width: 767px) {
            .start-tutorial-link {
                padding: 0.4rem 0.6rem;
                font-size: 0.9rem;
            }
        }


        /* Section Heading */
        .section-heading {
            font-family: 'Orbitron', sans-serif;
            font-size: 2.8rem;
            font-weight: 700;
            text-align: center;
            margin-bottom: 2.5rem;
            color: var(--color-primary-text); /* Headings use primary text color */
            /* Stronger pink/magenta glow for main headings */
            text-shadow: 0 0 12px var(--color-brand-accent-pink-interactive); /* Uses interactive pink for glow */
        }
        @media (max-width: 767px) { /* Mobile adjustment */
            .section-heading {
                font-size: 2rem; /* Smaller on mobile */
                margin-bottom: 1.5rem;
            }
        }
        @media (min-width: 768px) {
            .section-heading {
                font-size: 4rem;
            }
        }

        /* Section Paragraph */
        .section-paragraph {
            text-align: center;
            margin-bottom: 3rem;
            max-width: 48rem;
            margin-left: auto;
            margin-right: auto;
            font-size: 1.1rem;
            color: var(--color-paragraph-text);
        }
        /* Mobile adjustment for paragraph */
        @media (max-width: 767px) {
            .section-paragraph {
                font-size: 0.9rem;
                margin-bottom: 2rem;
            }
        }

        /* Search Bar Container */
        .search-bar-container {
            max-width: 38rem;
            margin-left: auto;
            margin-right: auto;
            margin-bottom: 3.5rem;
            position: relative;
        }
        /* Mobile adjustment for search bar container */
        @media (max-width: 767px) {
            .search-bar-container {
                margin-bottom: 2.5rem;
            }
        }

        /* Search Input */
        .search-input {
            width: 100%;
            padding: 1rem;
            padding-left: 3rem;
            border-radius: 0.75rem; /* Consistent rounding */
            outline: none;
            border: 0.15em solid var(--color-border-primary);
            background-color: var(--color-input-background);
            color: var(--color-primary-text);
            transition: box-shadow 0.3s, border-color 0.3s;
            font-size: 1rem;
            box-sizing: border-box; /* Ensures padding doesn't add to the width */
        }
        .search-input::placeholder {
            color: var(--color-placeholder-text);
        }
        .search-input:focus {
            box-shadow: 0 0 10px var(--color-focus-ring-accent); /* Pink/Magenta glow on focus */
            border-color: var(--color-focus-ring-accent);

        }
        /* Mobile adjustment for search input */
        @media (max-width: 767px) {
            .search-input {
                padding: 0.8rem;
                padding-left: 1.8rem; /* Reduced padding on mobile */
                font-size: 0.9rem;
            }
        }

        /* Search Icon */
        .search-icon {
            position: absolute;
            left: 0.9rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--color-placeholder-text);
        }
        
        /* Mobile adjustment for search icon */
        @media (max-width: 767px) {
            .search-icon {
                left: 0.5rem; /* Adjusted to match new padding */
            }
        }

        /* Search Loader */
        .search-loader {
            display: none;
            position: absolute;
            right: 0.9rem;
            top: 50%;
            transform: translateY(-50%);
            animation: spin 1s linear infinite;
            color: var(--color-loader-icon);
        }
        /* Mobile adjustment for search loader */
        @media (max-width: 767px) {
            .search-loader {
                right: 0.7rem;
            }
        }

        /* Tutorial Grid */
        .tutorial-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 2.5rem;
            max-width: 80rem;
            margin-left: auto;
            margin-right: auto;
            padding-bottom: 3rem;
        }
        /* Mobile adjustment for grid gap and padding */
        @media (max-width: 767px) {
            .tutorial-grid {
                gap: 1.5rem;
                padding-bottom: 2rem;
            }
        }
        @media (min-width: 768px) {
            .tutorial-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        @media (min-width: 1024px) {
            .tutorial-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        /* Initial Loading Message */
        .initial-loading-message {
            grid-column: 1 / -1;
            text-align: center;
            font-size: 1.3rem;
            padding-top: 5rem;
            padding-bottom: 5rem;
            color: var(--color-secondary-text);
        }
        /* Mobile adjustment for loading message */
        @media (max-width: 767px) {
            .initial-loading-message {
                font-size: 1rem;
                padding-top: 3rem;
                padding-bottom: 3rem;
            }
            .initial-loading-message .loader-icon {
                width: 1.8rem;
                height: 1.8rem;
            }
        }

        /* No Results Message */
        .no-results-message {
            text-align: center;
            font-size: 1.3rem;
            padding-top: 5rem;
            padding-bottom: 5rem;
            display: none;
            color: var(--color-secondary-text);
        }
        /* Mobile adjustment for no results message */
        @media (max-width: 767px) {
            .no-results-message {
                font-size: 1rem;
                padding-top: 3rem;
                padding-bottom: 3rem;
            }
        }

        /* Floating Chatbot Button */
        .chatbot-toggle-button {
            cursor: none;
            background-color: var(--color-button-primary-bg); /* Uses pink accent */
            color: var(--color-primary-text); /* Icon color on button */
            padding: 1rem;
            border-radius: 50%; /* Circular button */
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3), 0 0 8px var(--color-brand-accent-pink-interactive); /* Subtle pink glow */
            z-index: 50;
            transform: scale(1);
            transition: all 0.3s ease-in-out;
            position: fixed;
            bottom: 1.8rem;
            right: 1.8rem;
            border: none;
            outline: none;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 60px; /* Fixed size for circular button */
            height: 60px; /* Fixed size for circular button */
        }
        .chatbot-toggle-button:hover {
            background-color: var(--color-button-primary-hover-bg); /* Darker pink on hover */
            transform: scale(1.1);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4), 0 0 12px var(--color-brand-accent-pink-pure); /* Stronger pure pink glow on hover */
        }
        .chatbot-toggle-button svg {
            display: block;
        }
        .chatbot-toggle-button .hidden-icon {
            display: none;
        }
        /* Mobile adjustment for chatbot toggle button */
        @media (max-width: 767px) {
            .chatbot-toggle-button {
                bottom: 1rem;
                right: 1rem;
                width: 50px; /* Slightly smaller on mobile */
                height: 50px;
                padding: 0.75rem;
            }
            .chatbot-toggle-button svg {
                width: 24px;
                height: 24px;
            }
        }

        /* Chatbot Widget */
        .chatbot-container {
            position: fixed;
            bottom: 1.5rem;
            right: 1.5rem;
            width: 24rem; /* Standard width */
            border-radius: 0.75rem; /* Consistent rounding */
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.5), 0 0 15px var(--color-card-hover-shadow); /* Stronger pink glow */
            display: flex;
            flex-direction: column;
            z-index: 50;
            background-color: var(--color-input-background);
            border: 0.15em solid var(--color-border-primary);
        }
        @media (max-width: 767px) { /* Mobile adjustment for chatbot container */
            .chatbot-container {
                width: calc(100% - 2rem); /* Full width minus padding */
                left: 1rem; /* Centered with padding */
                right: 1rem;
                bottom: 1rem;
                max-height: 70vh; /* Limit height to prevent overflow on small screens */
            }
            .messages-container {
                max-height: calc(70vh - 100px); /* Adjust max-height based on header/input */
            }
        }
        @media (min-width: 768px) {
            .chatbot-container {
                width: 28rem;
            }
        }

        /* Chatbot Header */
        .chatbot-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.9rem;
            border-top-left-radius: 0.65rem; /* Match container radius */
            border-top-right-radius: 0.65rem; /* Match container radius */
            border-bottom: 1.5px solid var(--color-border-secondary);
            background-color: var(--color-chatbot-header-background);
        }

        .chatbot-close-button{
            background-color: transparent;
            border: none;
        }

        .chatbot-close-button svg{
            color: var(--color-chatbot-header-text);
        } 

        /* Mobile adjustment for chatbot header */
        @media (max-width: 767px) {
            .chatbot-header {
                padding: 0.7rem;
            }
            .chatbot-header-title {
                font-size: 1rem;
            }

        }

        /* Chatbot Messages Container */
        .messages-container {
            flex: 1;
            padding: 1rem;
            overflow-y: auto;
            max-height: 20rem;
        }
        /* Mobile adjustment for messages container */
        @media (max-width: 767px) {
            .messages-container {
                padding: 0.75rem;
            }
        }

        /* Initial Chatbot Message */
        .initial-chatbot-message {
            text-align: center;
            font-size: 0.85rem;
            font-style: italic;
            color: var(--color-secondary-text);
            padding: 0.4rem;
            border-radius: 0.4rem;
            background-color: var(--color-chatbot-bot-message-bg); /* Use bot message background */
        }
        /* Mobile adjustment for initial chatbot message */
        @media (max-width: 767px) {
            .initial-chatbot-message {
                font-size: 0.75rem;
                padding: 0.3rem;
            }
        }

        /* Chat Message */
        .chat-message {
            margin-bottom: 0.75rem;
        }
        .chat-message.user-message {
            text-align: right;
        }
        .chat-message.bot-message {
            text-align: left;
        }
        .chat-message span {
            display: inline-block;
            padding: 0.6rem 0.9rem;
            border-radius: 0.6rem;
            max-width: 80%;
            word-wrap: break-word;
            font-size: 0.9rem;
            color: var(--color-primary-text); /* Ensure message text is readable */
        }
        .chat-message.user-message span {
            background-color: var(--color-chatbot-user-message-bg);
        }
        .chat-message.bot-message span {
            background-color: var(--color-chatbot-bot-message-bg);
        }
        /* Mobile adjustment for chat message bubbles */
        @media (max-width: 767px) {
            .chat-message span {
                padding: 0.5rem 0.7rem;
                font-size: 0.8rem;
                max-width: 90%; /* Allow bubbles to be slightly wider */
            }
        }

        /* Chat Input Area */
        .chat-input-area {
            padding: 0.8rem;
            border-top: 1px solid var(--color-border-secondary);
            display: flex;
            align-items: center;
            border-bottom-left-radius: 0.65rem;
            border-bottom-right-radius: 0.65rem;
        }
        /* Mobile adjustment for chat input area */
        @media (max-width: 767px) {
            .chat-input-area {
                padding: 0.6rem;
            }
        }

        /* Chat Input */
        .chat-input {
            flex: 1;
            padding: 0.6rem;
            border-radius: 0.6rem;
            outline: none;
            border: 1px solid var(--color-border-secondary);
            background-color: var(--color-chatbot-header-background); /* Consistent with chatbot header */
            color: var(--color-primary-text);
            transition: box-shadow 0.2s, border-color 0.2s;
            font-size: 0.9rem;
        }
        .chat-input::placeholder {
            color: var(--color-placeholder-text);
        }
        .chat-input:focus {
            box-shadow: 0 0 8px var(--color-focus-ring-accent);
            border-color: var(--color-focus-ring-accent);
        }
        /* Mobile adjustment for chat input */
        @media (max-width: 767px) {
            .chat-input {
                padding: 0.5rem;
                font-size: 0.85rem;
            }
        }

        /* Send Message Button */
        .send-message-button {
            cursor: none;
            margin-left: 0.6rem;
            padding: 0.6rem;
            background-color: var(--color-button-primary-bg); /* Uses pink accent */
            color: var(--color-primary-text); /* Icon color */
            border-radius: 0.6rem;
            transition: background-color 0.2s, transform 0.2s, box-shadow 0.2s;
            border: none;
            outline: none;
        }
        .send-message-button:hover {
            background-color: var(--color-button-primary-hover-bg); /* Darker pink on hover */
            transform: scale(1.05);
            box-shadow: 0 0 8px var(--color-brand-accent-pink-pure); /* Pure pink glow */
        }
        .send-message-button:focus {
            outline: 2px solid var(--color-focus-ring-accent);
            outline-offset: 2px;
            background-color: var(--color-button-primary-hover-bg); /* Keep hover color on focus */
        }
        /* Mobile adjustment for send button */
        @media (max-width: 767px) {
            .send-message-button {
                margin-left: 0.4rem;
                padding: 0.5rem;
            }
            .send-message-button svg {
                width: 18px;
                height: 18px;
            }
        }

        /* Footer */
        .main-footer {
            padding-top: 2rem;
            padding-bottom: 2rem;
            text-align: center;
            font-size: 0.85rem;
            border-top-left-radius: 0.75rem;
            border-top-right-radius: 0.75rem;
            margin-top: 3.5rem;
            background-image: var(--color-card-background); /* Uses card background gradient */
            color: var(--color-footer-text);
            box-shadow: 0 -8px 25px rgba(0, 0, 0, 0.3);
        }
        /* Mobile adjustment for footer */
        @media (max-width: 767px) {
            .main-footer {
                padding-top: 1.5rem;
                padding-bottom: 1.5rem;
                font-size: 0.75rem;
                margin-top: 2.5rem;
            }
        }

        /* Custom mouse pointer styles */
        #custom-cursor-dot, #custom-cursor-circle {
            position: fixed;
            top: 0;
            left: 0;
            border-radius: 50%;
            pointer-events: none;
            z-index: 9999;
            transition: transform 0.1s ease-out, opacity 0.2s ease-out;
        }

        #custom-cursor-dot {
            width: 6px;
            height: 6px;
            background-color: var(--color-cursor-dot);
            opacity: 1;
            transform: translate(-50%, -50%);
            box-shadow: 0 0 4px var(--color-cursor-dot);
        }

        #custom-cursor-circle {
            width: 30px;
            height: 30px;
            border: 1px solid var(--color-brand-accent-pink-interactive); /* Pink border for general interactive */
            background-color: rgba(221, 0, 221, 0.1); /* Semi-transparent pink */
            transition: transform 0.1s ease-out, opacity 0.2s ease-out, width 0.2s ease-out, height 0.2s ease-out, background-color 0.3s ease-out, border-color 0.3s ease-out;
            opacity: 1;
            transform: translate(-50%, -50%);
            box-shadow: 0 0 8px var(--color-brand-accent-pink-interactive); /* Subtle pink glow */
        }

        /* Hide custom cursor on mobile */
        @media(max-width: 767px) {
            #custom-cursor-circle,
            #custom-cursor-dot {
                display: none;
            }
        }

        /* General interactive element hover effects for custom cursor */
        .interactive-element-hover #custom-cursor-dot {
            opacity: 0;
        }

        .interactive-element-hover #custom-cursor-circle {
            width: 45px;
            height: 45px;
            background-color: rgba(255, 0, 255, 0.3); /* More noticeable pure pink tint on hover */
            border-color: var(--color-brand-accent-pink-pure);
            box-shadow: 0 0 12px var(--color-brand-accent-pink-pure);
        }

        /* Accent-specific hover effects for custom cursor - Blue/Cyan for cards */
        .tutorial-card-hover-accent #custom-cursor-dot {
            opacity: 0;
        }

        .tutorial-card-hover-accent #custom-cursor-circle {
            width: 45px;
            height: 45px;
            background-color: rgba(0, 204, 255, 0.3); /* Pure blue/cyan tint for card hover */
            border-color: var(--color-brand-accent-blue-pure); /* Pure blue/cyan border */
            box-shadow: 0 0 12px var(--color-brand-accent-blue-pure); /* Pure blue/cyan glow */
        }

        .start-tutorial-link-hover-accent #custom-cursor-dot {
            opacity: 0;
        }

        .start-tutorial-link-hover-accent #custom-cursor-circle {
            width: 45px;
            height: 45px;
            background-color: rgba(0, 170, 221, 0.3); /* Interactive blue/cyan tint for link hover */
            border-color: var(--color-brand-accent-blue-interactive); /* Interactive blue/cyan border */
            box-shadow: 0 0 12px var(--color-brand-accent-blue-interactive); /* Interactive blue/cyan glow */
        }

        /* Custom Ripple Effect */
        #custom-cursor-ripple {
            position: fixed;
            top: 0;
            left: 0;
            border-radius: 50%;
            pointer-events: none;
            z-index: 9998;
            background-color: var(--color-ripple-effect);
            opacity: 0;
            transform: translate(-50%, -50%) scale(0);
            width: 40px;
            height: 40px;
        }

        @keyframes ripple-effect {
            0% {
                transform: translate(-50%, -50%) scale(0);
                opacity: 1;
            }
            100% {
                transform: translate(-50%, -50%) scale(4);
                opacity: 0;
            }
        }

        .animate-ripple {
            animation: ripple-effect 0.5s ease-out forwards;
        }

        /* Ensure interactive elements still show pointer cursor */
        button, a, input[type="text"], .tutorial-card {
            cursor: none;
        }

    </style>
</head>
<body>

    <!-- Custom Mouse Pointer Elements -->
    <div id="custom-cursor-dot"></div>
    <div id="custom-cursor-circle"></div>
    <div id="custom-cursor-ripple"></div> <!-- New element for click effect -->

    <!-- Tutorials Section -->
    <section class="tutorials-section">
        <h1 class="section-heading animate-on-scroll">Our Popular Tutorials</h1>
        <p class="section-paragraph animate-on-scroll">
            Explore our curated collection of tutorials. Use the search bar below to find exactly what you're looking for!
        </p>

        <!-- Search Bar -->
        <div class="search-bar-container animate-on-scroll">
            <input
                type="text"
                id="searchTermInput"
                autocomplete="off"
                placeholder="Search for tutorials (e.g., React, Figma, JavaScript basics)..."
                class="search-input"
            />
            <div class="search-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-search"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
            </div>
            <div id="searchLoader" class="search-loader">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-loader-2"><path d="M21 12a9 9 0 1 1-6.219-8.56"/></svg>
            </div>
        </div>

        <!-- Tutorial Grid -->
        <div id="tutorialGrid" class="tutorial-grid">
            <!-- Initial loading message -->
            <div id="initialLoadingMessage" class="initial-loading-message">
                Loading tutorials...
                <div class="loader-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-loader-2"><path d="M21 12a9 9 0 1 1-6.219-8.56"/></svg>
                </div>
            </div>
            <!-- Tutorials will be rendered here by JavaScript -->
        </div>
        <div id="noResultsMessage" class="no-results-message">
            No tutorials found matching your search. Try a different query!
        </div>
    </section>

    <!-- Floating Chatbot Button -->
    <button
        id="chatbotToggleButton"
        class="chatbot-toggle-button"
        aria-label="Toggle Chatbot"
    >
        <svg id="chatbotOpenIcon" xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-message-square"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
        <svg id="chatbotCloseIcon" xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x hidden-icon"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
    </button>

    <!-- Chatbot Widget -->
    <div id="chatbotContainer" class="chatbot-container hidden">
        <div class="chatbot-header">
            <h3 class="chatbot-header-title">Chat with AI</h3>
            <button id="chatbotCloseButton" class="chatbot-close-button">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"  stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
            </button>
        </div>
        <div id="messagesContainer" class="messages-container custom-scrollbar">
            <p id="initialChatbotMessage" class="initial-chatbot-message">
                Hello! How can I assist you with LearnSphere tutorials today?
            </p>
            <!-- Messages will be appended here -->
        </div>
        <div class="chat-input-area">
            <input
                type="text"
                id="chatInput"
                autocomplete="off"
                placeholder="Type your message..."
                class="chat-input"
            />
            <button
                id="sendMessageButton"
                class="send-message-button"
            >
                <!-- Changed to Lucide Send icon -->
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-send"><path d="m22 2-7 20-4-9-9-4 20-7z"/></svg>
            </button>
        </div>
    </div>

    <!-- Footer -->
    <footer class="main-footer animate-on-scroll">
        <p>&copy; <span id="currentYear"></span> LearnSphere. All rights reserved.</p>
        <p>Empowering Your Learning Journey</p>
    </footer>

    <script>
        let allTutorials = []; // This will now be populated dynamically from JSON files
        let filteredTutorials = [];
        let isSearching = false;
        let searchTimeout;

        // List of tutorial file names (corresponding to tutorial IDs and .json filenames)
        // This array will be AUTOMATICALLY UPDATED by the Node.js script.
        // DO NOT EDIT THIS MANUALLY IF YOU ARE USING THE AUTOMATION SCRIPT.
        const tutorialFileNames = [
            'tds',
            'electronics',
            'automobile',
            'survey',
        ];

        // --- Utility Functions ---
        function debounce(func, delay) {
            let timeout;
            return function(...args) {
                const context = this;
                clearTimeout(timeout);
                timeout = setTimeout(() => func.apply(context, args), delay);
            };
        }

        // --- Tutorial Data Loading ---
        async function loadTutorialsFromFiles() {
            const initialLoadingMessage = document.getElementById('initialLoadingMessage');
            initialLoadingMessage.classList.remove('hidden'); // Show loading message

            const fetchedTutorials = [];
            for (const fileName of tutorialFileNames) {
                try {
                    // Fetching .json files from the 'tutorials' subfolder
                    const response = await fetch(`tutorials/${fileName}.json`);
                    if (!response.ok) {
                        console.error(`Failed to fetch tutorials/${fileName}.json: ${response.status} ${response.statusText}`);
                        continue; // Skip to the next file if one fails
                    }
                    const tutorialData = await response.json(); // Parsing as JSON
                    fetchedTutorials.push(tutorialData);
                } catch (fetchError) {
                    console.error(`Error fetching or parsing tutorials/${fileName}.json:`, fetchError);
                }
            }
            allTutorials = fetchedTutorials;
            filteredTutorials = [...allTutorials]; // Initialize filtered with all loaded tutorials
            initialLoadingMessage.classList.add('hidden'); // Hide loading message
            renderTutorials(filteredTutorials); // Render after loading
        }


        // --- Tutorial Rendering ---
        function renderTutorials(tutorialsToRender) {
            const tutorialGrid = document.getElementById('tutorialGrid');
            const noResultsMessage = document.getElementById('noResultsMessage');
            tutorialGrid.innerHTML = ''; // Clear existing tutorials

            if (tutorialsToRender.length === 0) {
                noResultsMessage.classList.remove('hidden');
                // Adjust message based on whether a search was performed or if it's truly empty
                if (isSearching) {
                    noResultsMessage.textContent = 'Searching for tutorials...'; // This message is shown while AI is processing
                } else {
                    noResultsMessage.textContent = 'No tutorials found matching your search. Try a different query!';
                }
                return;
            } else {
                noResultsMessage.classList.add('hidden');
            }

            tutorialsToRender.forEach((tutorial, index) => {
                const cardHtml = `
                    <div class="tutorial-card group relative animate-on-scroll">
                        <img
                            src="${tutorial.imageUrl}"
                            alt="${tutorial.title}"
                            class="tutorial-card-image"
                            onerror="this.onerror=null;this.src='https://placehold.co/600x400/374151/d1d5db?text=Image+Error';"
                        />
                        <div class="tutorial-card-content">
                            <h3 class="tutorial-title">${tutorial.title}</h3>
                            <p class="tutorial-description">
                                ${tutorial.description}
                            </p>
                            <div class="tutorial-tags">
                                ${tutorial.tags.map(tag => `<span class="tutorial-tag">${tag}</span>`).join('')}
                            </div>
                            <div class="start-tutorial-link-container">
                                <a
                                    href="${tutorial.link}"
                                    target="_blank"
                                    rel="noopener noreferrer"
                                    class="start-tutorial-link"
                                >
                                <span style="display: inline-flex; align-items: center;">
                                Start Tutorial
                                <svg style="margin-left: 5px;" xmlns="http://www.w3.org/2000/svg" width="24" height="24" baseProfile="tiny" version="1.2" viewBox="0 0 24 24" id="right-arrow" fill="currentColor">
                                    <path d="M4 19.999a.999.999 0 0 1-1-1v-1a9.98 9.98 0 0 1 8-9.796V6.499c0-.534.208-1.036.585-1.414.756-.757 2.075-.756 2.829-.001l6.288 6.203a.996.996 0 0 1 0 1.424l-6.293 6.207c-.746.746-2.067.751-2.823-.005A1.986 1.986 0 0 1 11 17.499v-1.437c-2.495.201-4.523.985-6.164 3.484a1 1 0 0 1-.836.453zm8-5.989l1-.01v3.499l5.576-5.5L13 6.503V10s-.384-.004-.891.052a7.982 7.982 0 0 0-6.892 6.08C7.338 14.404 9.768 14.066 12 14.01z"></path>
                                </svg>
                                </span>

                                </a>
                            </div>
                        </div>
                    </div>
                `;
                tutorialGrid.insertAdjacentHTML('beforeend', cardHtml);
            });

            // After rendering, observe the new tutorial cards
            // Apply staggered delays dynamically for a smoother effect
            const tutorialCards = tutorialGrid.querySelectorAll('.tutorial-card');
            tutorialCards.forEach((card, i) => {
                card.style.animationDelay = `${i * 0.1}s`; // Staggered delay for each card
            });
            observeElementsForAnimation('.tutorial-card', 'is-visible');
        }

        // --- AI Search Functionality ---
        async function performAISearch(query) {
            const searchLoader = document.getElementById('searchLoader');
            const noResultsMessage = document.getElementById('noResultsMessage');

            if (query.trim() === '') {
                // If the query is empty, show all tutorials
                isSearching = false; // Not actively searching if query is empty
                searchLoader.classList.add('hidden'); // Hide loader
                noResultsMessage.classList.add('hidden'); // Hide no results message
                filteredTutorials = [...allTutorials]; // Reset to all tutorials
                renderTutorials(filteredTutorials); // Render all tutorials
                return; // Exit the function
            }

            // Only show loader and "Searching..." message if a non-empty query is being processed
            isSearching = true;
            searchLoader.classList.remove('hidden');
            renderTutorials([]); // Temporarily clear and show "Searching..." while AI processes

            try {
                // Prompt for search functionality - Enhanced for complex queries
                const prompt = `You are an intelligent tutorial search assistant for LearnSphere. Your primary goal is to find the most relevant tutorial IDs based on a user's query, making the search experience user-friendly and highly engaging.

Here is the list of available tutorials, including their IDs, titles, descriptions, and tags (which represent categories, subjects, and skill levels):
${allTutorials.map(t => `- ID: ${t.id}, Title: ${t.title}, Description: ${t.description}, Tags: ${t.tags.join(', ')}`).join('\n')}

User Query: "${query}"

Instructions for Advanced Search:
1.  **Interpret and Refine Query:**
    * **Spelling Correction:** First, intelligently correct any obvious spelling mistakes or typos in the user's query (e.g., "electnic" should be understood as "electronic").
    * **Summarization/Intent Extraction:** If the query is long, conversational, or vague, distill it down to its core intent, key topics, and relevant keywords. Focus on what the user *really* wants to learn.
2.  **Advanced Analysis:**
    * **Category/Subject Inference:** Infer relevant categories or subjects from the refined query (e.g., 'wire' -> 'electronics', 'design' -> 'UI/UX', 'ML' -> 'Machine Learning', 'tax' -> 'Finance').
    * **Skill Level Detection:** Identify any specified skill levels (e.g., 'advanced', 'beginner', 'basics', 'mastering', 'intro').
    * **Synonym and Related Concepts:** Consider synonyms and closely related concepts to broaden the search intelligently.
    * **Combine Criteria:** Understand and combine multiple criteria from the query (e.g., "beginner web development" should prioritize tutorials that are both beginner-friendly and cover web development).
3.  **Relevance Matching:** Find the tutorial IDs that are most relevant based on a combination of:
    * Direct keyword matches (from the refined query).
    * Inferred categories/subjects.
    * Detected skill levels.
    * Overall semantic similarity to the tutorial content.
    Prioritize results that offer the best match across these criteria.
4.  **Output Format:** Respond ONLY with a comma-separated list of the 'id's of the relevant tutorials. Do not include any other text, explanations, or formatting. If no tutorials are relevant after your analysis, respond with "none".

Examples of expected output based on various queries:
- Query: "electnic advanced" -> Example Output: electronics,advanced-electronics-tutorial-id (assuming such an advanced electronics tutorial exists and is relevant)
- Query: "basics of figma" -> Example Output: figma-ui-design
- Query: "how to build a website with react" -> Example Output: react-hooks-mastery,nodejs-rest-apis
- Query: "learn about wire" -> Example Output: electronics
- Query: "I want to get into creating digital art for web interfaces, something for people who are just starting out" -> Example Output: graphic-design-basics,figma-ui-design
- Query: "complex grid layouts for responsive pages" -> Example Output: advanced-css-grid`;

                const chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
                const payload = { contents: chatHistory };
                // --- IMPORTANT: Your Gemini API Key for GitHub Pages deployment ---
                const apiKey = "AIzaSyDY5VgoB8_Rvlmna0xPfiRow3FD2VrheQw";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    console.error(`API Error: ${response.status} - ${response.statusText} - ${errorText}`);
                    throw new Error(`API returned an error: ${response.statusText || 'Unknown Error'}`);
                }

                const result = await response.json();

                let aiResponse = '';
                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    aiResponse = result.candidates[0].content.parts[0].text.trim();
                }

                console.log("AI Search Response:", aiResponse);

                if (aiResponse.toLowerCase() === 'none' || aiResponse === '') {
                    filteredTutorials = []; // No relevant IDs from AI, so show nothing
                } else {
                    // Attempt to parse AI response as comma-separated IDs
                    const relevantIds = aiResponse.split(',').map(id => id.trim());
                    // Filter based on IDs returned by AI
                    filteredTutorials = allTutorials.filter(tutorial => relevantIds.includes(tutorial.id));

                    // If AI returned IDs but none matched existing tutorials, or if parsing failed to yield valid IDs,
                    // consider a fallback or a more specific "no results" message.
                    if (filteredTutorials.length === 0 && relevantIds.length > 0) {
                        console.warn("AI returned IDs, but none matched existing tutorials. Falling back to client-side search.");
                        // Fallback to client-side search if AI's IDs don't match anything
                        fallbackClientSideSearch(query);
                    }
                }
            } catch (error) {
                console.error('Error during AI search or parsing AI response:', error);
                appendMessage('bot', "Oops! Something went wrong on my end. Please try again later.");
                // Ensure filtered tutorials are reset or handled on error to avoid empty grid
                filteredTutorials = [...allTutorials]; // Fallback to showing all tutorials on error
            } finally {
                isSearching = false;
                document.getElementById('searchLoader').classList.add('hidden');
                renderTutorials(filteredTutorials); // Render whatever filteredTutorials ended up being
            }
        }

        // Fallback search now only checks title, description, and tags
        function fallbackClientSideSearch(query) {
            const lowerCaseQuery = query.toLowerCase();
            filteredTutorials = allTutorials.filter(tutorial =>
                tutorial.title.toLowerCase().includes(lowerCaseQuery) ||
                tutorial.description.toLowerCase().includes(lowerCaseQuery) ||
                tutorial.tags.some(tag => tag.toLowerCase().includes(lowerCaseQuery))
            );
        }

        // --- Chatbot Functionality (Rebuilt) ---
        const chatMessages = []; // Stores the chat history for context
        let isChatbotLoading = false; // Prevents multiple simultaneous API calls

        /**
         * Appends a message to the chatbot's message container.
         * @param {string} sender - 'user' or 'bot'
         * @param {string} text - The message text
         */
        function appendMessage(sender, text) {
            const messagesContainer = document.getElementById('messagesContainer');
            const initialMessage = document.getElementById('initialChatbotMessage');

            // Remove initial message once the first message (user or bot) is appended
            if (initialMessage) {
                initialMessage.remove();
            }

            const messageDiv = document.createElement('div');
            messageDiv.classList.add('chat-message');
            messageDiv.classList.add(sender === 'user' ? 'user-message' : 'bot-message');

            const messageSpan = document.createElement('span');
            messageSpan.textContent = text;
            messageDiv.appendChild(messageSpan);
            messagesContainer.appendChild(messageDiv);

            // Scroll to the bottom to show the latest message
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        /**
         * Toggles the visibility of the chatbot loading indicator.
         * @param {boolean} show - True to show, false to hide.
         */
        function showChatbotLoading(show) {
            const messagesContainer = document.getElementById('messagesContainer');
            let loadingDiv = document.getElementById('chatbotLoadingDiv');

            if (show) {
                if (!loadingDiv) {
                    loadingDiv = document.createElement('div');
                    loadingDiv.id = 'chatbotLoadingDiv';
                    loadingDiv.classList.add('chat-message', 'bot-message');
                    loadingDiv.innerHTML = `<span>Thinking...</span>`;
                    messagesContainer.appendChild(loadingDiv);
                }
                messagesContainer.scrollTop = messagesContainer.scrollHeight; // Scroll to show thinking message
            } else {
                if (loadingDiv) {
                    loadingDiv.remove(); // Remove the loading indicator
                }
            }
        }

        /**
         * Sends a message to the Gemini API and handles the response for the chatbot.
         */
        async function sendChatMessage() {
            const chatInput = document.getElementById('chatInput');
            const message = chatInput.value.trim();

            if (message === '') return; // Don't send empty messages
            if (isChatbotLoading) return; // Prevent multiple sends

            // Append user message to UI and clear input
            appendMessage('user', message);
            chatMessages.push({ sender: 'user', text: message }); // Add to history
            chatInput.value = '';

            // Disable input and button, show loading indicator
            isChatbotLoading = true;
            chatInput.disabled = true;
            document.getElementById('sendMessageButton').disabled = true;
            showChatbotLoading(true);

            try {
                let botResponseText;

                // Check for specific "who are you" query
                if (message.toLowerCase() === 'who are you') {
                    botResponseText = 'Name : Sachintha Lakshan';
                } else {
                    // Prepare chat history for the API call
                    // Include a system instruction to guide the AI's persona and knowledge base
                    let chatHistory = [{
                        role: "user",
                        parts: [{ text: "You are a helpful assistant for LearnSphere, an online tutorial platform. Answer questions about web development, UI/UX design, programming (like JavaScript, React, Node.js, Java), CSS, HTML, and general learning. Keep your answers concise and directly related to learning or our tutorials. Do not engage in topics outside of LearnSphere's educational content. If asked about something unrelated, politely redirect to our tutorials. " }]
                    }];

                    // Add previous messages to history for context, limiting to a few for efficiency
                    // Ensure roles are 'user' or 'model' for the API
                    const recentMessages = chatMessages.slice(Math.max(chatMessages.length - 6, 0)); // Keep last 6 messages for context
                    recentMessages.forEach(msg => {
                        chatHistory.push({ role: msg.sender === 'user' ? 'user' : 'model', parts: [{ text: msg.text }] });
                    });

                    // Add the current user message
                    chatHistory.push({ role: "user", parts: [{ text: message }] });

                    const payload = { contents: chatHistory };
                    // --- IMPORTANT: Your Gemini API Key for GitHub Pages deployment ---
                    const apiKey = "AIzaSyDY5VgoB8_Rvlmna0xPfiRow3FD2VrheQw";
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        const errorText = await response.text();
                        console.error(`API Error: ${response.status} - ${response.statusText} - ${errorText}`);
                        throw new Error(`API returned an error: ${response.statusText || 'Unknown Error'}`);
                    }

                    const result = await response.json();

                    if (result.candidates && result.candidates.length > 0 &&
                        result.candidates[0].content && result.candidates[0].content.parts &&
                        result.candidates[0].content.parts.length > 0) {
                        botResponseText = result.candidates[0].content.parts[0].text;
                    } else {
                        console.warn("Chatbot AI response structure unexpected or empty.");
                        botResponseText = "Sorry, I couldn't get a clear response. Can you please rephrase?";
                    }
                }

                // Append bot's response to UI and history
                appendMessage('bot', botResponseText);
                chatMessages.push({ sender: 'bot', text: botResponseText }); // Add to history

            } catch (error) {
                console.error('Error during chatbot API call:', error);
                appendMessage('bot', "Oops! Something went wrong on my end. Please try again later.");
            } finally {
                // Re-enable input and button, hide loading indicator
                isChatbotLoading = false;
                chatInput.disabled = false;
                document.getElementById('sendMessageButton').disabled = false;
                showChatbotLoading(false);
            }
        }

        /**
         * Toggles the visibility of the chatbot widget.
         */
        function toggleChatbot() {
            const chatbotContainer = document.getElementById('chatbotContainer');
            const openIcon = document.getElementById('chatbotOpenIcon');
            const closeIcon = document.getElementById('chatbotCloseIcon');

            if (chatbotContainer.classList.contains('hidden')) {
                chatbotContainer.classList.remove('hidden');
                chatbotContainer.classList.add('animate-fade-in-up');
                openIcon.classList.add('hidden-icon');
                closeIcon.classList.remove('hidden-icon');
            } else {
                chatbotContainer.classList.add('hidden');
                chatbotContainer.classList.remove('animate-fade-in-up');
                openIcon.classList.remove('hidden-icon');
                closeIcon.classList.add('hidden-icon');
            }
        }

        // --- Intersection Observer for Scroll Animations ---
        function observeElementsForAnimation(selector, animationClass) {
            const elements = document.querySelectorAll(selector);

            const observer = new IntersectionObserver((entries, observer) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        // Add the animation class
                        entry.target.classList.add(animationClass);
                    } else {
                        // Remove the animation class when the element is out of view
                        entry.target.classList.remove(animationClass);
                        // Reset animation for elements that use keyframe animations
                        if (entry.target.classList.contains('section-heading') ||
                            entry.target.classList.contains('section-paragraph') ||
                            entry.target.classList.contains('search-bar-container') ||
                            entry.target.classList.contains('tutorial-card') ||
                            entry.target.classList.contains('main-footer')) {
                            // To re-trigger keyframe animations, remove and re-add the class
                            // A small timeout ensures the browser registers the removal before re-adding
                            setTimeout(() => {
                                entry.target.style.animation = 'none'; // Temporarily disable animation
                                entry.target.offsetHeight; // Trigger reflow
                                entry.target.style.animation = ''; // Re-enable animation
                            }, 10);
                        }
                    }
                });
            }, {
                root: null, // viewport
                threshold: 0.1 // Trigger when 10% of the element is visible
            });

            elements.forEach(element => {
                observer.observe(element);
            });
        }

        // Smooth scroll for scroll wheel
        let currentScrollY = window.scrollY;
        let animationFrameId = null;

        function smoothScrollTo(targetScrollY, duration = 500) {
            const start = window.scrollY;
            const change = targetScrollY - start;
            const startTime = performance.now();

            function animateScroll(currentTime) {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);

                const easedProgress = progress * (2 - progress);

                window.scrollTo(0, start + change * easedProgress);

                if (progress < 1) {
                    animationFrameId = requestAnimationFrame(animateScroll);
                } else {
                    animationFrameId = null;
                }
            }

            if (animationFrameId) {
                cancelAnimationFrame(animationFrameId);
            }
            animationFrameId = requestAnimationFrame(animateScroll);
        }

        // Event listener for scroll wheel
        window.addEventListener('wheel', (e) => {
            e.preventDefault();

            const scrollAmount = e.deltaY * 0.8;
            currentScrollY += scrollAmount;

            const maxScrollY = document.documentElement.scrollHeight - window.innerHeight;
            currentScrollY = Math.max(0, Math.min(currentScrollY, maxScrollY));

            smoothScrollTo(currentScrollY, 500);
        }, { passive: false });

        // --- Custom Cursor JavaScript ---
        const customCursorDot = document.getElementById('custom-cursor-dot');
        const customCursorCircle = document.getElementById('custom-cursor-circle');
        const customCursorRipple = document.getElementById('custom-cursor-ripple'); // Get ripple element

        let mouseX = 0;
        let mouseY = 0;
        let circleX = 0;
        let circleY = 0;

        document.addEventListener('mousemove', (e) => {
            mouseX = e.clientX;
            mouseY = e.clientY;
            // The dot is now positioned directly at mouseX, mouseY and centered via CSS transform
            customCursorDot.style.left = `${mouseX}px`;
            customCursorDot.style.top = `${mouseY}px`;

            // Determine if the hovered element is interactive or a 'start tutorial' link
            const target = e.target;
            const isStartTutorialLink = target.closest('.start-tutorial-link');
            const isTutorialCard = target.closest('.tutorial-card');
            const isInputOrButton = target.tagName === 'BUTTON' || target.tagName === 'INPUT' || target.closest('button') || target.closest('a');

            // Reset all custom cursor classes first
            document.body.classList.remove('hide-custom-cursor');
            document.body.classList.remove('interactive-element-hover');
            document.body.classList.remove('tutorial-card-hover-accent');
            document.body.classList.remove('start-tutorial-link-hover-accent');


            if (isStartTutorialLink) {
                document.body.classList.add('start-tutorial-link-hover-accent');
            } else if (isTutorialCard) {
                document.body.classList.add('tutorial-card-hover-accent');
            } else if (isInputOrButton) {
                document.body.classList.add('interactive-element-hover');
            }
        });

        // Handle mousedown for ripple effect
        document.addEventListener('mousedown', (e) => {
            // Only trigger ripple if the custom cursor is visible (not on 'start tutorial' link)
            // The `start-tutorial-link-hover-accent` class is applied when hovering over the link,
            // which also means the custom cursor is hidden. So, if this class is present, don't show ripple.
            if (!document.body.classList.contains('start-tutorial-link-hover-accent')) {
                customCursorRipple.style.left = `${e.clientX}px`;
                customCursorRipple.style.top = `${e.clientY}px`;

                // Reset animation by removing and re-adding class, forcing reflow
                customCursorRipple.classList.remove('animate-ripple');
                // A small timeout ensures the browser registers the removal before re-adding
                setTimeout(() => {
                    customCursorRipple.classList.add('animate-ripple');
                }, 10); // Small delay to ensure animation reset
            }
        });


        function animateCustomCursor() {
            // Lerp (linear interpolation) for smooth trailing effect
            // The circle now interpolates towards the dot's position (which is the true mouseX, mouseY)
            circleX += (mouseX - circleX) * 0.8; /* Adjusted lerp for very tight follow */
            circleY += (mouseY - circleY) * 0.8; /* Adjusted lerp for very tight follow */

            customCursorCircle.style.left = `${circleX}px`;
            customCursorCircle.style.top = `${circleY}px`;

            requestAnimationFrame(animateCustomCursor);
        }

        // Start the custom cursor animation loop
        animateCustomCursor();

        // --- Event Listeners and Initial Setup ---
        document.addEventListener('DOMContentLoaded', () => {
            // Set current year in footer
            document.getElementById('currentYear').textContent = new Date().getFullYear();

            // Load tutorials from files
            loadTutorialsFromFiles(); // This function will now fetch from JSON files

            // Observe all relevant elements for animation
            observeElementsForAnimation('.section-heading', 'is-visible');
            observeElementsForAnimation('.section-paragraph', 'is-visible');
            observeElementsForAnimation('.search-bar-container', 'is-visible');
            observeElementsForAnimation('.main-footer', 'is-visible');
            // Tutorial cards are observed within renderTutorials to ensure they are present in DOM


            // Search input event listener with debounce
            const searchTermInput = document.getElementById('searchTermInput');
            searchTermInput.addEventListener('input', debounce((e) => {
                performAISearch(e.target.value);
            }, 200));

            // Chatbot button listeners
            document.getElementById('chatbotToggleButton').addEventListener('click', toggleChatbot);
            document.getElementById('chatbotCloseButton').addEventListener('click', toggleChatbot);
            document.getElementById('sendMessageButton').addEventListener('click', sendChatMessage);
            document.getElementById('chatInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    sendChatMessage();
                }
            });
        });
    </script>
</body>
</html>
